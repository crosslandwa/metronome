# Metronome

A metronome built with the Web Audio API, React and Redux

## Build

```bash
npm run build
# or
npm run watch #automatically re-build whenever changes are made
```

For production, a minified build is generated by
```bash
NODE_ENV=production npm run build
```

## Run

Build the app (see above), then start the dev server via:

```bash
# requires python3 to be available
npm run dev-webserver
```

Then navigate your browser to http://localhost:8000

## Tests

```bash
npm test
```
Tests are run with [Jest](https://facebook.github.io/jest/)

## Linting

```bash
npm run lint
```

Linting is done with [ESLint](https://eslint.org/) and is configured to conform code to https://standardjs.com/

## ES6ified code

Rollup is configured with the appropriate [Babel](https://babeljs.io/) plugins to write the app with ES6 language features. This applies to both application code **and** test code

## Code choices

- CSS can be imported in the app via `import 'My.css'` - Rollup is configured to bundle CSS into the built JS artefact
- [Redux DevTools](https://github.com/zalmoxisus/redux-devtools-extension) extension is configured out of the box (requires dev tools be installed in the browser)

## Deployment

This site is hosted on [Github Pages](https://crosslandwa.github.io/metronome). Deployment happens on commit to the `main` branch via a Github Action

### Logo

Generate a SVG logo - here's the markup for the current one

```html
    <svg id="logo" width="300" height="300">
      <rect width="300" height="300" fill="#555" rx="50" ry="50" />
      <rect x="55" y="20" width="50" height="220" fill="#7AF" rx="25" ry="25" />
      <circle cx="65" cy="220" r="40" fill="#7AF" />
      <polyline
        points="79 37 160 128 241 37"
        stroke="#7AF"
        fill="transparent"
        stroke-width="40"
      />
      <rect x="215" y="20" width="50" height="220" fill="#7AF" rx="25" ry="25" />
      <circle cx="225" cy="220" r="40" fill="#7AF" />
    </svg>
```

Then run the following in the dev tools to convert the SVG to a 64 x 64 pixel `.ico` file (which the browser will download via a prompt)

```js
const imageData = new XMLSerializer().serializeToString(document.getElementById("logo"))
const img = document.createElement('img');
img.onload = () => {
  const canvas = document.createElement('canvas');
  const SIZE_IN_PIXELS = 64
  canvas.width = SIZE_IN_PIXELS;
  canvas.height = SIZE_IN_PIXELS;
  canvas.getContext('2d').drawImage(img, 0, 0, SIZE_IN_PIXELS, SIZE_IN_PIXELS);
  canvas.toBlob(
    (imgBlob) => {
      const downloadLink = document.createElement("a");
      downloadLink.href = URL.createObjectURL(new Blob(
        [
          new Uint8Array([0, 0, 1, 0]).buffer, // ico file header
          new Uint8Array([1, 0]).buffer, // Indiciate 1 image [01, 00]
          new Uint8Array([canvas.width]).buffer, // Image width
          new Uint8Array([canvas.height]).buffer, // Image height
          new Uint8Array([0]).buffer, // Specify no color palette [00]
          new Uint8Array([0]).buffer, // Reserved space [00]
          new Uint8Array([1, 0]).buffer, // Specify 1 color plane
          new Uint8Array([32, 0]).buffer, // Specify 32 bits per pixel (bit depth)
          new Uint32Array([imgBlob.size]).buffer, // Specify image size in bytes
          new Uint32Array([22]).buffer, // Specify image offset in bytes
          imgBlob
        ],
        { type: 'image/vnd.microsoft.icon' }
      ));
      downloadLink.download = "favicon.ico";
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    },
    'image/png'
  );
};
console.log(`<link rel="shortcut icon" type="image/x-icon" href="data:image/svg+xml;base64,${btoa(imageData)}">`)
img.src = URL.createObjectURL(new Blob([imageData], {type:"image/svg+xml;charset=utf-8"}));
```

Finally
- copy the `<link>` that is output to the console into the `<head>` of the HTML template (this includes an embedded svg favicon)
- copy the downloaded file to `/dist/favicon.ico`
Finally, place the generated string in the `href` attribute of the `<link rel="shortcut icon">` element in the `<head>` of the page
